{"version":3,"file":"action.min.js","sources":["../src/action.js"],"sourcesContent":["\n// This file is part of Moodle - http://moodle.org/.\n//\n// Moodle is free software: you can redistribute it and/or modify.\n// it under the terms of the GNU General Public License as published by.\n// the Free Software Foundation, either version 3 of the License, or.\n// This file is part of Moodle - http://moodle.org/.\n// Moodle is distributed in the hope that it will be useful,.\n// but WITHOUT ANY WARRANTY; without even the implied warranty of.\n// MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the.\n// This file is part of Moodle - http://moodle.org/.\n// You should have received a copy of the GNU General Public License.\n// This file is part of Moodle - http://moodle.org/.\n/*\n * @package   local_restrict\n * @copyright 2025 Moayad Shloul <shloul97@gmail.com>\n * @license   http://www.gnu.org/copyleft/gpl.html GNU GPL v3 or later.\n */\ndefine(\n    ['jquery', 'core/ajax', 'core/str'], function ($, Ajax, str) {\n        'use strict';\n        return {\n            init: function () {\n\n                var ajxerr = '';\n                var jserr = '';\n                var args = '';\n                var mkadminconfirm;\n                var adminremovecofnirm;\n                var delconfirm;\n                var failedalert;\n\n                var mkadmin;\n                var rmadmin;\n                var active;\n                var activate;\n                var inactive;\n                var suspend;\n\n\n\n\n                var long_strings = [\n                    { key: 'ajxerr', component: 'local_restrict' },\n                    { key: 'jserr', component: 'local_restrict' },\n                    { key: 'args', component: 'local_restrict' },\n                    { key: 'mkadminconfirm', component: 'local_restrict' },\n                    { key: 'adminremovecofnirm', component: 'local_restrict' },\n                    { key: 'delconfirm', component: 'local_restrict' },\n                    { key: 'failedalert', component: 'local_restrict' }\n                ];\n\n                str.get_strings(long_strings).then(\n                    function (results) {\n                        ajxerr = results[0];\n                        jserr = results[1];\n                        args = results[2];\n                        mkadminconfirm = results[3];\n                        adminremovecofnirm = results[4];\n                        delconfirm = results[5];\n                        failedalert = results[6];\n                    }\n                ).catch(\n                    function (e) {\n                        alert(failedalert, e);\n                    }\n                );\n                const stringKeys = [\n                    'rmadmin', 'mkadmin', 'suspend',\n                    'activate', 'active', 'inactive'\n                ];\n\n                const strings = stringKeys.map(key => ({ key, component: 'local_restrict' }));\n\n                str.get_strings(strings)\n                    .then(results => {\n                        const localized = Object.fromEntries(stringKeys.map((key, i) => [key, results[i]]));\n                        // You can now access them as:\n                        // localized.rmadmin, localized.mkadmin, etc.\n                        rmadmin = localized.rmadmin;\n                        mkadmin = localized.mkadmin;\n                        activate = localized.activate;\n                        inactive = localized.inactive;\n                        suspend = localized.suspend;\n                        active = localized.active;\n                    })\n                    .catch(e => {\n                        alert(failedalert, e);\n                    });\n\n\n                $('button[name=action-btn]').click(\n                    function () {\n\n                        var deviceId = $(this).attr('data-id');\n                        var action = $(this).attr('data-action');\n                        var btn = $(this);\n                        var spanText = $('#span-' + deviceId);\n                        var dataAction = 'sus';\n                        if (action == 'sus') {\n                            dataAction = 'act';\n                        }\n\n                        if (action === 'del') {\n                            if (confirm(delconfirm) == true) {\n\n\n\n                                var requestArgs = {\n                                    deviceid: parseInt(deviceId),\n                                    action: action.toString()\n                                };\n\n                                Ajax.call(\n                                    [{\n                                        methodname: 'local_restrict_update_labs',\n                                        args: requestArgs\n                                    }]\n                                )[0].then(\n                                    function () {\n                                        $('#tr-' + deviceId).fadeOut(300);\n                                    }\n                                ).catch(\n                                    function (err) {\n                                        let error = `<span>${ajxerr} ${err} <span><br><span>\n                                        ${jserr} ${err.message}</span><br><span>\n                                        ${args} ${requestArgs}</span>`;\n                                        $('#ajx-err').html(error);\n\n                                    }\n                                );\n\n                            }\n                            else {\n\n                            }\n                        }\n                        else {\n\n\n                            var requestArgs = {\n                                deviceid: parseInt(deviceId),\n                                action: action.toString()\n                            };\n\n                            Ajax.call(\n                                [{\n                                    methodname: 'local_restrict_update_labs',\n                                    args: requestArgs\n                                }]\n                            )[0].then(\n                                function () {\n                                    if (action != 'del') {\n                                        btn.attr('data-action', dataAction);\n                                        btn.toggleClass('btn-warning btn-success');\n                                        if (btn.html() === suspend) {\n                                            btn.html(activate);\n                                            spanText.html(inactive);\n                                        } else {\n                                            btn.html(suspend);\n                                            spanText.html(active);\n                                        }\n\n                                        spanText.toggleClass('text-success text-danger');\n                                    }\n\n\n                                }\n                            ).catch(\n                                function (err) {\n                                    let error = `<span>${ajxerr} ${err} <span><br><span>\n                                    ${jserr} ${err.message}</span><br><span>\n                                    ${args} ${requestArgs}</span>`;\n                                    $('#ajx-err').html(error);\n                                }\n                            );\n\n                        }\n\n                    }\n                );\n\n\n                $(\"button[name=admin-btn]\").click(\n                    function () {\n\n                        var dataAction = $(this).attr('data-action');\n                        var btn = $(this);\n                        var deviceId = $(this).attr('data-id');\n                        var lab = btn.attr('data-lab');\n                        var action = 'admin';\n\n                        var confirmString = '';\n\n\n\n\n\n                        if (dataAction == 'mkadmin') {\n                            confirmString = mkadminconfirm;\n\n                        }\n                        else {\n                            confirmString = adminremovecofnirm;\n                        }\n\n                        if (confirm(confirmString) == true) {\n\n\n\n                            var requestArgs = {\n                                deviceid: parseInt(deviceId, 10),   // ensure number.\n                                action: action.toString(),\n                                dataaction: dataAction.toString(),\n                                lab: parseInt(lab, 10)\n                            };\n\n                            Ajax.call(\n                                [{\n                                    methodname: 'local_restrict_update_labs',\n                                    args: requestArgs\n                                }]\n                            )[0].then(\n                                function (e) {\n\n                                    if (e.status == 1) {\n                                        btn.toggleClass('btn-primary btn-secondary');\n                                        if (dataAction === \"mkadmin\") {\n                                            dataAction = \"rmadmin\";\n                                            btn.html(rmadmin);\n                                            btn.attr('data-action', 'rmadmin');\n                                        }\n                                        else if (dataAction === \"rmadmin\") {\n                                            btn.html(mkadmin);\n                                            btn.attr('data-action', 'mkadmin');\n                                        }\n                                    }\n\n\n                                }\n                            ).catch(\n                                function (err) {\n                                    let error = `<span>${ajxerr} ${err} <span><br><span>\n                                    ${jserr} ${err.message}</span><br><span>\n                                    ${args} ${requestArgs}</span>`;\n                                    $('#ajx-err').html(error);\n                                }\n                            );\n\n                        }\n                    }\n                );\n            }\n        };\n    }\n);"],"names":["define","$","Ajax","str","init","mkadminconfirm","adminremovecofnirm","delconfirm","failedalert","mkadmin","rmadmin","active","activate","inactive","suspend","ajxerr","jserr","args","get_strings","key","component","then","results","catch","e","alert","stringKeys","strings","map","localized","Object","fromEntries","i","click","deviceId","this","attr","action","btn","spanText","dataAction","confirm","requestArgs","deviceid","parseInt","toString","call","methodname","fadeOut","err","error","message","html","toggleClass","lab","confirmString","dataaction","status"],"mappings":"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"}