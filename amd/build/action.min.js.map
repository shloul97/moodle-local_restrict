{"version":3,"file":"action.min.js","sources":["../src/action.js"],"sourcesContent":["define(['jquery', 'core/ajax', 'core/str'], function ($, Ajax, str) {\n    'use strict';\n    return {\n        init: function () {\n\n            var ajxerr = '';\n            var jserr = '';\n            var args = '';\n            var mkadminconfirm;\n            var adminremovecofnirm;\n            var delconfirm;\n\n\n            var strings = [\n                { key: 'ajxerr', component: 'local_restrict' },\n                { key: 'jserr', component: 'local_restrict' },\n                { key: 'args', component: 'local_restrict' },\n                { key: 'mkadminconfirm', component: 'local_restrict' },\n                { key: 'adminremovecofnirm', component: 'local_restrict' },\n                { key: 'delconfirm', component: 'local_restrict' }\n\n            ];\n\n            str.get_strings(strings).then(function (results) {\n                ajxerr = results[0];\n                jserr = results[1];\n                args = results[2];\n                mkadminconfirm = results[3];\n                adminremovecofnirm = results[4];\n                delconfirm = results[5];\n            }).catch(function (e) {\n                alert('Failed to load strings:', e);\n            });\n\n\n            $('button[name=action-btn]').click(function () {\n\n                var deviceId = $(this).attr('data-id');\n                var action = $(this).attr('data-action');\n                var btn = $(this);\n                var spanText = $('#span-' + deviceId);\n                var dataAction = 'sus';\n                if (action == 'sus') {\n                    dataAction = 'act';\n                }\n\n                if (action === 'del') {\n                    if (confirm(delconfirm) == true) {\n\n\n\n                        var requestArgs = {\n                            deviceid: parseInt(deviceId),\n                            action: action.toString()\n                        };\n\n                        Ajax.call([{\n                            methodname: 'local_restrict_update_labs',\n                            args: requestArgs\n                        }])[0].then(function () {\n                            $('#tr-' + deviceId).fadeOut(300);\n                        }).catch(function (err) {\n                            let error = `<span>${ajxerr} ${err} <span><br><span>\n                    ${jserr} ${err.message}</span><br><span>\n                    ${args} ${requestArgs}</span>`;\n                            $('#ajx-err').html(error);\n\n                        });\n\n                    }\n                    else {\n\n                    }\n                }\n                else {\n\n\n                    var requestArgs = {\n                        deviceid: parseInt(deviceId),\n                        action: action.toString()\n                    };\n\n                    Ajax.call([{\n                        methodname: 'local_restrict_update_labs',\n                        args: requestArgs\n                    }])[0].then(function () {\n                        if (action != 'del') {\n                            btn.attr('data-action', dataAction);\n                            btn.toggleClass('btn-warning btn-success');\n                            if (btn.html() === \"Suspend\") {\n                                btn.html(\"Activate\");\n                                spanText.html(\"Inactive\");\n                            } else {\n                                btn.html(\"Suspend\");\n                                spanText.html(\"Active\");\n                            }\n\n                            spanText.toggleClass('text-success text-danger');\n                        }\n\n\n                    }).catch(function (err) {\n                        let error = `<span>${ajxerr} ${err} <span><br><span>\n                    ${jserr} ${err.message}</span><br><span>\n                    ${args} ${requestArgs}</span>`;\n                        $('#ajx-err').html(error);\n                    });\n\n                }\n\n            });\n\n\n            $(\"button[name=admin-btn]\").click(function () {\n\n                var dataAction = $(this).attr('data-action');\n                var btn = $(this);\n                var deviceId = $(this).attr('data-id');\n                var lab = btn.attr('data-lab');\n                var action = 'admin';\n\n                var confirmString = '';\n\n\n\n\n\n                if (dataAction == 'mkadmin') {\n                    confirmString = mkadminconfirm;\n\n                }\n                else {\n                    confirmString = adminremovecofnirm;\n                }\n\n                if (confirm(confirmString) == true) {\n\n\n\n                    var requestArgs = {\n                        deviceid: parseInt(deviceId, 10),   // ensure number\n                        action: action.toString(),\n                        dataaction: dataAction.toString(),\n                        lab: parseInt(lab, 10)\n                    };\n\n                    Ajax.call([{\n                        methodname: 'local_restrict_update_labs',\n                        args: requestArgs\n                    }])[0].then(function (e) {\n\n                        if (e.status == 1) {\n                            btn.toggleClass('btn-primary btn-secondary');\n                            if (dataAction === \"mkadmin\") {\n                                dataAction = \"rmadmin\";\n                                btn.html(\"Remove Admin\");\n                                btn.attr('data-action', 'rmadmin');\n                            }\n                            else if (dataAction === \"rmadmin\") {\n                                btn.html(\"Make Admin\");\n                                btn.attr('data-action', 'mkadmin');\n                            }\n                        }\n\n\n                    }).catch(function (err) {\n                        let error = `<span>${ajxerr} ${err} <span><br><span>\n                    ${jserr} ${err.message}</span><br><span>\n                    ${args} ${requestArgs}</span>`;\n                        $('#ajx-err').html(error);\n                    });\n\n                }\n            });\n        }\n    };\n});"],"names":["define","$","Ajax","str","init","mkadminconfirm","adminremovecofnirm","delconfirm","ajxerr","jserr","args","get_strings","key","component","then","results","catch","e","alert","click","deviceId","this","attr","action","btn","spanText","dataAction","confirm","requestArgs","deviceid","parseInt","toString","call","methodname","fadeOut","err","error","message","html","toggleClass","lab","confirmString","dataaction","status"],"mappings":"AAAAA,+BAAO,CAAC,SAAU,YAAa,aAAa,SAAUC,EAAGC,KAAMC,WAEpD,CACHC,KAAM,eAKEC,eACAC,mBACAC,WALAC,OAAS,GACTC,MAAQ,GACRC,KAAO,GAgBXP,IAAIQ,YAVU,CACV,CAAEC,IAAK,SAAUC,UAAW,kBAC5B,CAAED,IAAK,QAASC,UAAW,kBAC3B,CAAED,IAAK,OAAQC,UAAW,kBAC1B,CAAED,IAAK,iBAAkBC,UAAW,kBACpC,CAAED,IAAK,qBAAsBC,UAAW,kBACxC,CAAED,IAAK,aAAcC,UAAW,oBAIXC,MAAK,SAAUC,SACpCP,OAASO,QAAQ,GACjBN,MAAQM,QAAQ,GAChBL,KAAOK,QAAQ,GACfV,eAAiBU,QAAQ,GACzBT,mBAAqBS,QAAQ,GAC7BR,WAAaQ,QAAQ,MACtBC,OAAM,SAAUC,GACfC,MAAM,0BAA2BD,MAIrChB,EAAE,2BAA2BkB,OAAM,eAE3BC,SAAWnB,EAAEoB,MAAMC,KAAK,WACxBC,OAAStB,EAAEoB,MAAMC,KAAK,eACtBE,IAAMvB,EAAEoB,MACRI,SAAWxB,EAAE,SAAWmB,UACxBM,WAAa,SACH,OAAVH,SACAG,WAAa,OAGF,QAAXH,WAC2B,GAAvBI,QAAQpB,YAAqB,KAIzBqB,YAAc,CACdC,SAAUC,SAASV,UACnBG,OAAQA,OAAOQ,YAGnB7B,KAAK8B,KAAK,CAAC,CACPC,WAAY,6BACZvB,KAAMkB,eACN,GAAGd,MAAK,WACRb,EAAE,OAASmB,UAAUc,QAAQ,QAC9BlB,OAAM,SAAUmB,SACXC,sBAAiB5B,mBAAU2B,sDACrC1B,kBAAS0B,IAAIE,0DACb3B,iBAAQkB,uBACF3B,EAAE,YAAYqC,KAAKF,eAS1B,CAGGR,YAAc,CACdC,SAAUC,SAASV,UACnBG,OAAQA,OAAOQ,YAGnB7B,KAAK8B,KAAK,CAAC,CACPC,WAAY,6BACZvB,KAAMkB,eACN,GAAGd,MAAK,WACM,OAAVS,SACAC,IAAIF,KAAK,cAAeI,YACxBF,IAAIe,YAAY,2BACG,YAAff,IAAIc,QACJd,IAAIc,KAAK,YACTb,SAASa,KAAK,cAEdd,IAAIc,KAAK,WACTb,SAASa,KAAK,WAGlBb,SAASc,YAAY,gCAI1BvB,OAAM,SAAUmB,SACXC,sBAAiB5B,mBAAU2B,sDACjC1B,kBAAS0B,IAAIE,0DACb3B,iBAAQkB,uBACN3B,EAAE,YAAYqC,KAAKF,cAQ/BnC,EAAE,0BAA0BkB,OAAM,eAE1BO,WAAazB,EAAEoB,MAAMC,KAAK,eAC1BE,IAAMvB,EAAEoB,MACRD,SAAWnB,EAAEoB,MAAMC,KAAK,WACxBkB,IAAMhB,IAAIF,KAAK,YAGfmB,cAAgB,MAOhBA,cADc,WAAdf,WACgBrB,eAIAC,mBAGU,GAA1BqB,QAAQc,eAAwB,KAI5Bb,YAAc,CACdC,SAAUC,SAASV,SAAU,IAC7BG,OAtBK,QAsBUQ,WACfW,WAAYhB,WAAWK,WACvBS,IAAKV,SAASU,IAAK,KAGvBtC,KAAK8B,KAAK,CAAC,CACPC,WAAY,6BACZvB,KAAMkB,eACN,GAAGd,MAAK,SAAUG,GAEF,GAAZA,EAAE0B,SACFnB,IAAIe,YAAY,6BACG,YAAfb,YACAA,WAAa,UACbF,IAAIc,KAAK,gBACTd,IAAIF,KAAK,cAAe,YAEJ,YAAfI,aACLF,IAAIc,KAAK,cACTd,IAAIF,KAAK,cAAe,gBAKjCN,OAAM,SAAUmB,SACXC,sBAAiB5B,mBAAU2B,sDACjC1B,kBAAS0B,IAAIE,0DACb3B,iBAAQkB,uBACN3B,EAAE,YAAYqC,KAAKF"}.