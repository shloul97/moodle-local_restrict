{"version":3,"file":"distrpute.min.js","sources":["../src/distrpute.js"],"sourcesContent":["\n// This file is part of Moodle - http://moodle.org/.\n//\n// Moodle is free software: you can redistribute it and/or modify.\n// it under the terms of the GNU General Public License as published by.\n// the Free Software Foundation, either version 3 of the License, or.\n// This file is part of Moodle - http://moodle.org/.\n// Moodle is distributed in the hope that it will be useful,.\n// but WITHOUT ANY WARRANTY; without even the implied warranty of.\n// MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the.\n// This file is part of Moodle - http://moodle.org/.\n// You should have received a copy of the GNU General Public License.\n// This file is part of Moodle - http://moodle.org/.\n/*\n * @package   local_restrict\n * @copyright 2025 Moayad Shloul <shloul97@gmail.com>\n * @license   http://www.gnu.org/copyleft/gpl.html GNU GPL v3 or later.\n */\ndefine(['jquery', 'core/ajax','core/str'], function ($, Ajax,str) {\n    'use strict';\n    return {\n        init: function () {\n\n            var msg;\n            var status;\n            var statustxt;\n            var response;\n            var args;\n            var failedalert;\n            var select_course;\n\n            var strings = [\n                { key: 'msg', component: 'local_restrict' },\n                { key: 'status', component: 'local_restrict' },\n                { key: 'statustxt', component: 'local_restrict' },\n                { key: 'response', component: 'local_restrict' },\n                { key: 'args', component: 'local_restrict' },\n                { key: 'delconfirm', component: 'local_restrict' },\n                { key: 'failedalert', component: 'local_restrict' },\n                { key: 'selectcourselabs', component: 'local_restrict' }\n\n            ];\n\n             str.get_strings(strings).then(function (results) {\n                msg = results[0];\n                status = results[1];\n                statustxt = results[2];\n                response = results[3];\n                args = results[4];\n                failedalert = results[6];\n                select_course = results[7];\n            }).catch(function (e) {\n                alert(failedalert, e);\n            });\n\n\n            // -------- Form Submit.\n            $('.mform').submit(function (e) {\n                e.preventDefault();\n\n                var data = $(this).serializeArray();\n                var labs = [];\n                var quizes = [];\n\n                //labs and course debugging.\n                let course_debug = data.find(x => x.name === \"course\")?.value;\n                let labs_debug = data.filter(x => x.name === \"labs[]\").map(x => x.value);\n\n                if(!course_debug.length|| labs_debug.length <= 0){\n                    alert(select_course);\n                    return;\n                }\n\n                $(this).find('input[name=\"labs[]\"]:checked').each(function () {\n                    labs.push($(this).val());\n                });\n\n                $(this).find('input[name=\"quizes[]\"]:checked').each(function () {\n                    quizes.push($(this).val());\n                });\n\n                var usersArgs = {\n                    courseid: parseInt(data[2].value),\n                    labs: labs,\n                    quiz: quizes\n                };\n\n                Ajax.call([{\n                    methodname: 'local_restrict_get_users',\n                    args: usersArgs\n                }])[0].then(function (res) {\n                    var msgDiv = $('.msg-div');\n                    msgDiv.removeClass('msg-err msg-success');\n\n                    if (res.status === 0) {\n                        msgDiv.html(res.message).addClass('msg-err').fadeIn(200);\n                    } else {\n                        msgDiv.html(res.message).addClass('msg-success').fadeIn(200);\n                    }\n\n                }).catch(function (err) {\n                    let fullError = `\n                                    <div style=\"color:red;\">\n                                        <strong> ${str.get_string('ajxerr','local_restrict')}</strong><br>\n                                        ${msg} ${err.message || 'N/A'}<br>\n                                        ${status} ${err.status || 'N/A'}<br>\n                                        ${statustxt} ${err.statusText || 'N/A'}<br>\n                                        ${response}\n                                        ${err.responseText || JSON.stringify(err)}<br>\n                                        ${args}\n                                        ${JSON.stringify(usersArgs)}\n                                    </div>\n                                `;\n                    $('#ajx-err').html(fullError);\n                });\n\n            });\n\n            // -------- Course Change.\n            $('input[name=course]').change(function () {\n                var val = parseInt($(this).val());\n\n                // Get Quizes.\n                var quizesArgs = {\n                    courseid: val\n                };\n                Ajax.call([{\n                    methodname: 'local_restrict_get_quizes',\n                    args: quizesArgs\n                }])[0].then(function (res) {\n                    let html = '';\n                    if (res.status == 1) {\n                        $.each(res.message, function (index, value) {\n                            html += `<div class=\"form-check form-check-inline\" data-id=\"${index}\">\n                                <input class=\"form-check-input\" name=\"quizes[]\" type=\"checkbox\"\n                                id=\"checkbox${value.id}\" value=\"${value.id}\">\n                                <label class=\"form-check-label\" for=\"checkbox${value.id}\">${value.name}</label>\n                            </div>`;\n                        });\n                        $('#quizes-div').html(html);\n                    }\n\n                }).catch(function (err) {\n                    let fullError = `\n                                    <div style=\"color:red;\">\n                                        <strong> ${str.get_string('ajxerr','local_restrict')}</strong><br>\n                                        ${msg} ${err.message || 'N/A'}<br>\n                                        ${status} ${err.status || 'N/A'}<br>\n                                        ${statustxt} ${err.statusText || 'N/A'}<br>\n                                        ${response}\n                                        ${err.responseText || JSON.stringify(err)}<br>\n                                        ${args}\n                                        ${JSON.stringify(quizesArgs)}\n                                    </div>\n                                `;\n                    $('#ajx-err').html(fullError);\n                });\n            });\n        }\n    };\n});"],"names":["define","$","Ajax","str","init","msg","status","statustxt","response","args","failedalert","select_course","get_strings","key","component","then","results","catch","e","alert","submit","preventDefault","data","this","serializeArray","labs","quizes","course_debug","find","x","name","_data$find","value","labs_debug","filter","map","length","each","push","val","usersArgs","courseid","parseInt","quiz","call","methodname","res","msgDiv","removeClass","html","message","addClass","fadeIn","err","fullError","get_string","statusText","responseText","JSON","stringify","change","quizesArgs","index","id"],"mappings":"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"}